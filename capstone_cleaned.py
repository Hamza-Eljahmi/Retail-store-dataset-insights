# -*- coding: utf-8 -*-
"""Capstone_cleaned.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1240Kz4VEoorK6QkBJPMv4HO8cpWgxUur
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
df = pd.read_csv('/content/cleaned_dataset2.csv')

"""# Total Revenue by category"""

category_revenue = df.groupby('Category')['Total Spent'].sum().sort_values()


plt.figure(figsize=(12,6))

min_val = category_revenue.min() * 0.95
plt.xlim(min_val, category_revenue.max() * 1.05)
bars = plt.barh(category_revenue.index, category_revenue.values)
for bar in bars:
    width = bar.get_width()
    plt.text(width + (category_revenue.max()*0.01),
             bar.get_y() + bar.get_height()/2,
             f"{width:,.0f}",
             va='center')


plt.title("Revenue by Category", fontsize=16, fontweight='bold')
plt.xlabel("Revenue", fontsize=12)
plt.xticks(fontsize=10)
plt.yticks(fontsize=11)

plt.grid(axis='x', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

category_revenue

"""# Average Price Per Category"""

avg_price = df.groupby('Category')['Price Per Unit'].mean().sort_values()

plt.figure(figsize=(12,6))

min_val = avg_price.min() * 0.9
plt.ylim(min_val, avg_price.max() * 1.05)

bars = plt.bar(avg_price.index, avg_price.values)

# Add labels
for bar in bars:
    height = bar.get_height()
    plt.text(bar.get_x() + bar.get_width()/2,
             height + (avg_price.max()*0.01),
             f"{height:.2f}",
             ha='center', fontsize=10)

plt.title("Average Price Per Category", fontsize=16, fontweight='bold')
plt.ylabel("Average Price")
plt.xticks(rotation=45, fontsize=11)
plt.grid(axis='y', linestyle='--', alpha=0.4)

plt.tight_layout()
plt.show()

avg_price

"""#Top-Selling Items by Quantity"""

top_items_qty = (
    df.groupby('Item')['Quantity']
    .sum()
    .sort_values(ascending=False)
    .head(3)
)

plt.figure(figsize=(12,6))

min_val = top_items_qty.min() * 0.9
plt.xlim(min_val, top_items_qty.max() * 1.05)

bars = plt.barh(top_items_qty.index, top_items_qty.values)

for bar in bars:
    width = bar.get_width()
    plt.text(width + (top_items_qty.max()*0.01),
             bar.get_y() + bar.get_height()/2,
             f"{width:.0f}",
             va='center')

plt.title(" top Selling Items by Quantity", fontsize=16, fontweight='bold')
plt.xlabel("Total Quantity Sold")
plt.grid(axis='x', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

top_items_qty

"""# Which customer has the highest order frequency?"""

order_freq = (
    df["Customer ID"]
    .value_counts()
    .sort_values(ascending=False)
)

top3_freq = order_freq.head(3)



plt.figure(figsize=(10,6))

plt.hlines(
    y=top3_freq.index,
    xmin=top3_freq.min()*0.9,
    xmax=top3_freq.values,
    color='gray',
    linewidth=2
)

plt.plot(top3_freq.values, top3_freq.index, "o", markersize=12)


offset = top3_freq.max() * 0.03

for customer, value in top3_freq.items():
    plt.text(
        value + offset,             t
        customer,
        f"{value}",
        va='center',
        fontsize=11
    )


plt.title(" Order Frequency", fontsize=16, weight='bold')
plt.xlabel("Number of Orders", fontsize=13)

plt.xlim(top3_freq.min()*0.9, top3_freq.max()*1.15)

plt.grid(axis='x', linestyle='--', alpha=0.3)

plt.tight_layout()
plt.show()

top3_freq

"""# Do customers prefer online or in-store shopping"""

shopping_pref = df["Location"].value_counts()

plt.figure(figsize=(7,7))

wedges, texts, autotexts = plt.pie(
    shopping_pref.values,
    labels=shopping_pref.index,
    autopct='%1.1f%%',
    pctdistance=0.75
)

centre_circle = plt.Circle((0,0), 0.50, fc='white')
plt.gca().add_artist(centre_circle)

plt.title("Customer Shopping Preference", fontsize=16, weight='bold')

plt.tight_layout()
plt.show()

shopping_pref

"""# Which months have the highest revenue?"""

df["Transaction Date"] = pd.to_datetime(df["Transaction Date"])


df["Year"]  = df["Transaction Date"].dt.year
df["Month"] = df["Transaction Date"].dt.month_name()
df["MonthNum"] = df["Transaction Date"].dt.month


unique_years = sorted(df["Year"].unique())
unique_years = [y for y in unique_years if y != 2025]

for yr in unique_years:
    year_df = df[df["Year"] == yr]

    monthly_rev = (
        year_df.groupby(["MonthNum","Month"])["Total Spent"].sum()
        .sort_index()
    )

    plt.figure(figsize=(12,5))
    plt.plot(
        monthly_rev.index.get_level_values(1),
        monthly_rev.values,
        marker='o',
        linewidth=2
    )

    plt.title(f"Monthly Sales Trend â€“ {yr}", fontsize=16, weight='bold')
    plt.xlabel("Month", fontsize=13)
    plt.ylabel("Revenue", fontsize=13)


    plt.ylim(monthly_rev.min() * 0.95, monthly_rev.max() * 1.05)

    plt.grid(axis='y', linestyle='--', alpha=0.3)
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()

"""# Which location generates more revenue: Online or In-store?"""

location_revenue = df.groupby("Location")["Total Spent"].sum().sort_values()


location_percent = (location_revenue / location_revenue.sum() * 100).round(2)

plt.figure(figsize=(8,8))


wedges, texts, autotexts = plt.pie(
    location_revenue.values,
    labels=location_revenue.index,
    autopct=lambda p: f"{p:.2f}%",
    pctdistance=0.8,
    wedgeprops=dict(width=0.35),
    textprops={'fontsize': 12}
)

plt.title("Revenue Distribution", fontsize=16, weight='bold')


plt.gca().add_artist(plt.Circle((0,0), 0.65, color='white'))

plt.tight_layout()
plt.show()

location_percent

"""# Which items offer the best revenue per sale?"""

item_revenue_per_sale = (
    df.groupby("Item")["Total Spent"]
    .mean()
    .sort_values(ascending=False)
)

top3_items = item_revenue_per_sale.head(3)

plt.figure(figsize=(12,6))

bars = plt.barh(top3_items.index, top3_items.values, height=0.45)


for bar in bars:
    plt.text(
        bar.get_width()*1.01,
        bar.get_y() + bar.get_height()/2,
        f"{bar.get_width():.2f}",
        va='center'
    )

plt.title("items offer the best revenue per sale?", fontsize=16, weight='bold')
plt.xlabel("Average Revenue Per Sale", fontsize=13)

plt.xlim(top3_items.min()*0.95, top3_items.max()*1.10)
plt.grid(axis='x', linestyle='--', alpha=0.3)

plt.tight_layout()
plt.show()